{% extends 'base.html' %}
{% block conteudo %}
{% load static %}
<nav class="container w-100 col d-flex mt-4 mb-4 fs-6 fw-bold">
    <a href="{% url 'financas'%}" class="me-4 link-offset-2 link-offset-2-hover link-underline link-underline-opacity-25 link-underline-opacity-75-hover mb-5">Resumo</a>
    <a href="{% url 'listar_receitas' %}" class="me-4 link-offset-2 link-offset-2-hover link-underline link-underline-opacity-25 link-underline-opacity-75-hover mb-5">Receitas</a>
    <a href="{% url 'listar_despesas' %}" class="me-4 link-offset-2 link-offset-2-hover link-underline link-underline-opacity-25 link-underline-opacity-75-hover mb-5 active">Despesas</a>
</nav>
<h1>Despesas</h1>

{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} border-0 rounded-0 d-flex align-items-center" role="alert">
          <i class="fa-light fa-check-circle text-success-emphasis me-2"></i>
          <div>{{ message }}</div>
        </div>
    {% endfor %}
  </div>
{% endif %}

<div id="receitas">
    <div class="container w-100 d-flex mt-4 mb-4">
        <div class="input-group search-wrapper d-flex flex-nowrap rounded-4 me-3 flex-grow-1">
            <form method="get" class="input-group search-wrapper d-flex flex-nowrap rounded-4 me-3 flex-grow-1">
                <input type="search"
                       class="form-control-lg search-input border border-light w-100"
                       name="criterio"
                       value="{{ termo }}"
                       placeholder="Pesquisar">
                <button type="submit" class="btn btn-dark ms-2">Buscar</button>
            </form>
        </div>
        <div class="d-flex align-items-center">
            <i class="fa-solid fa-filter fa-lg"></i>
        </div>
    </div>
    <div class="container w-100 col d-flex mt-4 mb-4 fs-5 fw-bold">
        <button class="btn border border-light rounded-3 d-flex align-items-center btn-icon btn-dark btn-lg"
                onclick="prepararNovoCadastroDespesa()" type="button" data-bs-toggle="modal" data-bs-target="#modal-nova-despesa">
            <span class="btn-text pe-3">Novo</span>
            <i class="fa-solid fa-circle-plus"></i>
        </button>
    </div>

    <div class="container px-20 w-100 fs-6 text-center mt-5">
        <div class="table-responsive">
            <table class="table table-striped table-hover border-light text-dark">
                <thead>
                    <tr>
                        <th scope="col" class="text-nowrap w-auto">#</th>
                        <th scope="col" class="w-50">Descrição</th>
                        <th scope="col" class="text-nowrap w-auto">Data</th>
                        <th scope="col" class="text-nowrap w-auto">Valor</th>
                        <th scope="col" class="text-center w-auto">Editar</th>
                        <th scope="col" class="text-end w-auto">Excluir</th>
                    </tr>
                </thead>
                <tbody>
                    {% for despesa in despesas %}
                    <tr>
                        <td data-label="#" class="text-nowrap w-auto">{{ despesa.id }}</td>
                        <td data-label="Descrição">{{ despesa.descricao }}</td>
                        <td data-label="Data" class="text-nowrap w-auto">{{ despesa.data }} </td>
                        <td data-label="Valor" class="text-nowrap w-auto">{{ despesa.valor }}</td>
                        <td data-label="Editar" class="text-center w-auto">
                            <button class="btn btn-sm" onclick="carregarDadosDespesa('{{ despesa.id }}')"
                                data-bs-toggle="modal" data-bs-target="#modal-nova-despesa">
                                <i class="fa-solid fa-pen fa-lg" style="color: #9dc284;"></i>
                            </button>
                        </td>
                        <td data-label="Excluir" class="text-end w-auto">
                            <button class="btn btn-sm" onclick="abrirModalRemocao('{{ despesa.descricao }}', '{% url 'remover_despesa' despesa.id %}')"
                                data-toggle="modal" data-target="#modal-remocao">
                                <i class="fa-solid fa-trash-can fa-lg" style="color: #f95b56;"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6">Nenhuma despesa encontrada.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal inclusao despesa -->
<div class="modal fade" id="modal-nova-despesa" tabindex="-1" aria-labelledby="modal-title-7" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modal-title-7">
                    Cadastro Despesa
                </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'cadastrar_despesa' %}" method="post" class="w-400 mw-full">
                <input type="hidden" name="id_despesa" id="id_despesa">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="form-group">
                      <label for="id_descricao">Descrição</label>
                      <input type="text" class="form-control" id="id_descricao" name="descricao"
                             value="{{ form.descricao.value }}" required>
                    </div>

                    <div class="form-group">
                      <label for="id_valor">Valor</label>
                        <input type="number" step="0.01" class="form-control" id="id_valor" name="valor"
                               value="{{ form.valor.value }}" required>
                    </div>

                    <div class="form-group">
                      <label for="id_data">Data</label>
                      <input type="date" class="form-control" id="id_data" name="data"
                             value="{{ form.data.value }}" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary btn-block">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{% static 'js/financas/script.js' %}"></script>

{% endblock %}