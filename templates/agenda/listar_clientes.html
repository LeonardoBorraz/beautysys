{% extends 'base.html' %}
{% block conteudo %}
{% load static %}
{% load shared_tags %}

{% nav_menu "Agendamentos=agendamento,Clientes=lista_clientes" %}

<h1>Clientes</h1>

{% show_messages %}

<div id="clientes">
    <div class="container w-100 d-flex mt-4 mb-4">
        <div class="input-group search-wrapper d-flex flex-nowrap rounded-4 me-3 flex-grow-1">
            <form method="get" action="{% url 'lista_clientes' %}" class="d-flex flex-nowrap flex-grow-1 me-3">
                <input type="search"
                       class="form-control-lg search-input border border-light w-100"
                       name="criterio"
                       value="{{ termo|default:'' }}"
                       placeholder="Pesquisar cliente...">
                <button type="submit" class="btn btn-dark ms-2">Buscar</button>
            </form>
        </div>
        <div class="d-flex align-items-center">
            <i class="fa-solid fa-filter fa-lg"></i>
        </div>
    </div>

    <div class="container w-100 col d-flex mt-4 mb-4 fs-5 fw-bold">
        <button class="btn border border-light rounded-3 d-flex align-items-center btn-icon btn-dark btn-lg"
                onclick="prepararNovoCadastroCliente()" type="button" data-bs-toggle="modal" data-bs-target="#modal-novo-cliente">
            <span class="btn-text pe-3">Novo</span>
            <i class="fa-solid fa-circle-plus"></i>
        </button>
    </div>

    <div class="container px-20 w-100 fs-6 text-center mt-5">
        <div class="table-responsive">
            <table class="table table-striped table-hover border-light text-dark">
                <thead>
                    <tr>
                        <th scope="col" class="w-25">Nome</th>
                        <th scope="col" class="text-nowrap w-auto">Telefone</th>
                        <th scope="col" class="w-25">E-mail</th>
                        <th scope="col" class="text-center w-auto">Editar</th>
                        <th scope="col" class="text-end w-auto">Excluir</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cliente in clientes %}
                    <tr>
                        <td data-label="Nome">{{ cliente.nome }}</td>
                        <td data-label="Telefone" class="text-nowrap w-auto">{{ cliente.telefone }}</td>
                        <td data-label="E-mail">{{ cliente.email|default:"-" }}</td>
                        <td data-label="Editar" class="text-center w-auto">
                            <button class="btn btn-sm" onclick="carregarDadosCliente('{{ cliente.id }}')"
                                data-bs-toggle="modal" data-bs-target="#modal-novo-cliente">
                                <i class="fa-solid fa-pen fa-lg" style="color: #9dc284;"></i>
                            </button>
                        </td>
                        <td data-label="Excluir" class="text-end w-auto">
                            <button class="btn btn-sm" onclick="abrirModalRemocao('{{ cliente.nome }}', '{% url 'remover_cliente' cliente.id %}')"
                                data-toggle="modal" data-target="#modal-remocao">
                                <i class="fa-solid fa-trash-can fa-lg" style="color: #f95b56;"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">Nenhum cliente encontrado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para cadastro/edição de cliente -->
<div class="modal fade" id="modal-novo-cliente" tabindex="-1" aria-labelledby="modal-title-7" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modal-title-7">
                </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="#" method="post" class="w-400 mw-full">
                <input type="hidden" id="id_cliente" name="id_cliente">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="form-group">
                        <label for="id_nome">Nome</label>
                        <input type="text" class="form-control" id="id_nome" name="nome"
                               value="{{ form.nome.value|default:'' }}" required>
                    </div>

                    <div class="form-group">
                        <label for="id_telefone">Telefone</label>
                        <input type="text" class="form-control" id="id_telefone" name="telefone"
                               value="{{ form.telefone.value|default:'' }}" required>
                    </div>

                    <div class="form-group">
                        <label for="id_email">E-mail</label>
                        <input type="email" class="form-control" id="id_email" name="email"
                               value="{{ form.email.value|default:'' }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary btn-block">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{% static 'js/agenda/listar_clientes.js' %}"></script>

{% endblock %}
